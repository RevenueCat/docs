---
title: AppsFlyer
slug: appsflyer
excerpt: Integrate Purchases SDK with AppsFlyer for precise revenue tracking
hidden: false
---

With our AppsFlyer integration you can:

- Accurately track subscriptions generated from AppsFlyer campaigns, allowing you to know precisely how much revenue your campaigns generate.
- Send trial conversions and renewals directly from RevenueCat to AppsFlyer, allowing for tracking without an app open.
- Continue to follow your cohorts for months to know the long tail revenue generated by your campaigns.

### Integration at a Glance

| Includes Revenue | Supports Negative Revenue |   Sends Sandbox Events   | Includes Customer Attributes | Sends Transfer Events |                                       Optional Event Types                                        |
| :--------------: | :-----------------------: | :----------------------: | :--------------------------: | :-------------------: | :-----------------------------------------------------------------------------------------------: |
|        ✅        |            ✅             | Requires Sandbox API key |              ❌              |          ❌           | `non_subscription_purchase_event` `expiration_event` `billing_issue_event` `product_change_event` |

## 1. Install Appsflyer SDK

Before RevenueCat can integrate with Appsflyer, your app should be running the latest Appsflyer SDK. Refer to the [Appsflyer developer documentation](https://support.appsflyer.com/hc/en-us/sections/6551164458257-Integrate-the-AppsFlyer-SDK) for the latest installation instructions.

## 2. Send device data to RevenueCat

The Appsflyer integration requires some device-specific data. RevenueCat will only send events into Appsflyer if the below [Customer Attributes](/customers/customer-attributes) keys have been set for the device.

| Key            | Description                                                                                                                                     | Required         |
| :------------- | :---------------------------------------------------------------------------------------------------------------------------------------------- | :--------------- |
| `$appsflyerId` | Appsflyer Id. The unique Appsflyer identifier for the user                                                                                      | ✅ (required)    |
| `$idfa`        | iOS [advertising identifier](https://developer.apple.com/documentation/adsupport/asidentifiermanager/1614151-advertisingidentifier) UUID        | ✅ (recommended) |
| `$gpsAdId`     | Google [advertising identifier](https://developers.google.com/android/reference/com/google/android/gms/ads/identifier/AdvertisingIdClient.Info) | ✅ (recommended) |
| `$idfv`        | iOS [vender identifier](https://developer.apple.com/documentation/uikit/uidevice/1620059-identifierforvendor) UUID                              | ✅ (recommended) |
| `$ip`          | The IP address of the device                                                                                                                    | ❌ (optional)    |

:::warning Android ID deprecation
Due to policy changes from the Play Store, Android ID is no longer collected by RevenueCat's Android SDKs starting on versions 6.9.8+, 7.11.1+, and later major versions.

Therefore, Google's Advertising ID acts as the primary device identifier for Android devices in RevenueCat and when connecting with third-party integrations.
:::

These properties can be set manually, like any other [Attributes](/customers/customer-attributes), or through the helper methods to `collectDeviceIdentifiers()` and `setAppsflyerId()`.

import swiftContent from "!!raw-loader!@site/code_blocks/integrations/attribution/appsflyer_1.swift";
import kotlinContent from "!!raw-loader!@site/code_blocks/integrations/attribution/appsflyer_2.kt";

{/* Use the RCCodeBlock component to render the code blocks with tabs */}

<RCCodeBlock
  tabs={[
    { type: "swift", content: swiftContent },
    { type: "kotlin", content: kotlinContent },
  ]}
/>

You should make sure to set attributes after the _Purchases SDK_ is configured, and before the first purchase occurs. It's safe to set this multiple times, as only the new/updated values will be sent to RevenueCat. **If the AppsFlyer ID is not set, the customer's App User ID will be used instead.**

:::danger Device identifiers with iOS App Tracking Transparency (iOS 14.5+)
If you are requesting the App Tracking permission through ATT to access the IDFA, you can call `.collectDeviceIdentifiers()` _again_ if the customer accepts the permission to update the `$idfa` attribute in RevenueCat.
:::

:::info Import AdSupport Framework (iOS)
The AdSupport framework is required to access the IDFA parameter on iOS. Don't forget to import this into your project.
:::

![](/images/caf9cda-Screen_Shot_2020-09-14_at_7.09.36_PM_739bc6ccef43416570bf51e527f4e0fc.png "Screen Shot 2020-09-14 at 7.09.36 PM.png")

:::danger Remove any client-side purchase tracking
Make sure to remove all client-side tracking of revenue. Since RevenueCat will be sending events for all revenue actions, tracking purchases with the Appsflyer SDK directly can lead to double counting of revenue in Appsflyer.
:::

### (Optional) Send campaign data to RevenueCat

RevenueCat itself is not an attribution network, and can't determine which specific ad drove an install/conversion. However, if you're able to collect this information from another source, such as Appsflyer, it's possible to attach it to a Customer in RevenueCat using [Attributes](/customers/customer-attributes) as well.  
The below reserved key names can be used to optionally attach campaign data to a user. This data will then be sent through to other downstream analytics integrations and accessible via APIs and webhooks.

| Key            |
| :------------- |
| `$mediaSource` |
| `$campaign`    |
| `$adGroup`     |
| `$ad`          |
| `$keyword`     |
| `$creative`    |

### (Optional) Block sharing of events

To fulfill regulatory requirements like GDPR and CCPA, comply with user opt-out mechanisms, and other business reasons, you can limit sharing events with AppsFlyer's integrated partners and other third-party integrations. This is accomplished by setting the `$appsflyerSharingFilter` [Attribute](/customers/customer-attributes), which will block the sharing of S2S events via postbacks/API with the specified partners.

This Attribute accepts the following formats:

- String with the word `all`
- Array in the format `["partner_1", "partner_2"]`; stringify’ed as `"[\"partner_1\", \"partner_2\"]"`

If you are setting or editing the list of partner IDs through the [dashboard](/customers/customer-attributes#reading-attributes), use the format `partner_1,partner_2`

For a list of partner IDs, please contact your AppsFlyer CSM or AppsFlyer support.

:::info AppsFlyer Sharing Filter Restrictions
The `$appsflyerSharingFilter` has a limit of 50 partner IDs. If your team encounters issues with this limit, please reach out to our RevenueCat Support via the dashboard [Contact Us](https://app.revenuecat.com/settings/support) form in your account settings.
:::

## 3. Send RevenueCat events into AppsFlyer

After you've set up the _Purchases SDK_ to send attribution data from AppsFlyer to RevenueCat, you can "turn on" the integration and configure the event names from the RevenueCat dashboard.

1. Navigate to your project in the RevenueCat dashboard and find the _Integrations_ card in the left menu. Select **+ New**

![](/images/f43c7d1-app.revenuecat.com_projects_85ff18c7_collaborators_1_102e08e408ab8c9a966834182c81cbbc.png "app.revenuecat.com_projects_85ff18c7_collaborators (1).png")

2. Choose **AppsFlyer** from the Integrations menu
3. Add your general developer key/token if you use one AppsFlyer account for both iOS and Android in the developer key field in the **General configuration** path, or if you have specific developer keys for iOS and/or Android, add those in the associated UI fields in the **App configuration** path
4. If you have specific sandbox developer keys for iOS and/or Android, add those in the associated UI fields
5. Enter the event names that RevenueCat will send or choose the default event names
6. Select whether you want sales reported as gross revenue (before app store commission), or after store commission and/or estimated taxes.

:::info S2S tokens
If the token you're using to connect with AppsFlyer is a S2S token, be sure to check **Key is a S2S token** for your integration, since those keys use a unique endpoint. [Learn more about AppsFlyer token types.](https://support.appsflyer.com/hc/en-us/articles/360004562377-Managing-API-and-Server-to-server-S2S-tokens)
:::

![AppsFlyer Integration Configuration](/images/appsflyer-config.png)
![AppsFlyer Integration Events](/images/appsflyer-events.png)

## 4. Testing the Appsflyer integration

You can test the Appsflyer integration end-to-end before going live. It's recommended that you test the integration is working properly for new users, and any existing users that may update their app to a new version.

### Add a sandbox API key in the RevenueCat dashboard

Before you test the integration, make sure you have an Appsflyer API key set in the "Sandbox developer key" field in RevenueCat. This is required if you want the integration to trigger for sandbox purchases.

### Make a sandbox purchase with a new user

Simulate a new user installing your app, and go through your app flow to complete a sandbox purchase.

### Check that the required device data is collected

Navigate the the [Customer View](/dashboard-and-metrics/customer-history/basic-information) for the test user that just made a purchase. Make sure that all of the required data from step 1 above is listed as attributes for the user.

![](/images/1480c34-app.revenuecat.com_activity_777004e5_event_1b2e7407-a1bc-416a-84cf-b65688412bbe_2_3d37500fb07191a42435c1f3b14d182c.png)

### Check that the Appsflyer event delivered successfully

While still on the Customer View, click into the test purchase event in the [Customer History](/dashboard-and-metrics/customer-history) and make sure that the AppsFlyer integration event exists and was delivered successfully.

![](/images/00ff393-app.revenuecat.com_activity_777004e5_event_1b2e7407-a1bc-416a-84cf-b65688412bbe_c67df01a34580a8984500325f5294b0b.png)

:::info AppsFlyer reports events by install date
Under the Events view, AppsFlyer displays in-app events according to the install date of the user. This means if you select Jan 1 through Jan 8, you'll see the events that were performed by users who _installed_ within the selected date range.

Refer to [AppsFlyer's docs](https://support.appsflyer.com/hc/en-us/articles/207034486-Server-to-server-events-API-for-mobile-S2S-mobile-#troubleshooting) for more information about this.
:::

:::success You've done it!
You should start seeing events from RevenueCat appear in AppsFlyer.
:::
