---
title: Branch
slug: branch
excerpt: Integrate Purchases SDK with Branch for precise revenue tracking
hidden: false
---
With our Branch integration you can:

- Accurately track subscriptions generated from Branch campaigns, allowing you to know precisely how much revenue your campaigns generate.
- Send trial conversions and renewals directly from RevenueCat to Branch, allowing for tracking without an app open.
- Continue to follow your cohorts for months to know the long tail revenue generated by your campaigns.

### Integration at a Glance
| Includes Revenue | Supports Negative Revenue |  Sends Sandbox Events | Includes Subscriber Attributes | Sends Transfer Events |                             Optional Event Types                            |
|:----------------:|:-------------------------:|:---------------------:|:------------------------------:|:---------------------:|:---------------------------------------------------------------------------:|
|         ✅        |             ❌             | Requires test API key |                ❌               |           ❌           | `non_subscription_purchase_event` `expiration_event` `product_change_event` |

## 1. Set Branch user identity

In order to attach attribution data to the correct user, make sure the App User Ids for RevenueCat and Branch match. The easiest way to do this is to set the Branch SDK identity to match the _Purchases_ App User Id whether you're providing your own ids or using our randomly generated ids. 

### (Optional) Set a separate identity in Branch and RevenueCat

If you prefer to keep a separate user identity between Branch and RevenueCat, set a `$branchId` subscriber attribute in RevenueCat. If set, RevenueCat will use this identifier for Branch events instead of the App User Id.

:::info Install the Branch SDK
You will need to add the Branch SDK to your app before you can connect it with RevenueCat.
:::

import swiftContent from "!!raw-loader!@site/code_blocks/integrations/attribution/branch_1.swift";
import objectiveCContent from "!!raw-loader!@site/code_blocks/integrations/attribution/branch_2.m";
import javaContent from "!!raw-loader!@site/code_blocks/integrations/attribution/branch_3.java";
import reactNativeContent from "!!raw-loader!@site/code_blocks/integrations/attribution/branch_4.js";

<RCCodeBlock tabs={[
    { type: 'swift', content: swiftContent },
    { type: 'objc', content: objectiveCContent },
    { type: 'java', content: javaContent },
    { type: 'rn', content: reactNativeContent }
]} />

## 2. Send device data to RevenueCat

The Branch integration accepts some device-specific data that can be sent to RevenueCat through reserved [Subscriber Attributes](/customers/subscriber-attributes) keys.

| Key          | Description                                                                                                                                     | Required                        |
| :----------- | :---------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------ |
| `$idfa`      | iOS [advertising identifier](https://developer.apple.com/documentation/adsupport/asidentifiermanager/1614151-advertisingidentifier) UUID        | ✅ (required) if no `$idfv`      |
| `$idfv`      | iOS [vender identifier](https://developer.apple.com/documentation/uikit/uidevice/1620059-identifierforvendor) UUID                              | ✅ (required) if no `$idfa`      |
| `$gpsAdId`   | Google [advertising identifier](https://developers.google.com/android/reference/com/google/android/gms/ads/identifier/AdvertisingIdClient.Info) | ✅ (required) if no `$androidId` |
| `$androidId` | Android [device identifier](https://developer.android.com/reference/android/provider/Settings.Secure#ANDROID_ID)                                | ✅ (required) if no `$gpsAdId`   |
| `$ip`        | The IP address of the device                                                                                                                    | ✅ (required)                    |

These properties can be set manually, like any other [Subscriber Attributes](/customers/subscriber-attributes), or through the helper method `collectDeviceIdentifiers()`. 

import swiftContent2 from "!!raw-loader!@site/code_blocks/integrations/attribution/branch_5.swift";
import objectiveCContent2 from "!!raw-loader!@site/code_blocks/integrations/attribution/branch_6.m";
import kotlinContent from "!!raw-loader!@site/code_blocks/integrations/attribution/branch_7.kt";
import reactNativeContent2 from "!!raw-loader!@site/code_blocks/integrations/attribution/branch_8.js";
import cordovaContent from "!!raw-loader!@site/code_blocks/integrations/attribution/branch_cordova.js";

// Use the RCCodeBlock component to render the code blocks with tabs
<RCCodeBlock tabs={[
    { type: 'swift', content: swiftContent2 },
    { type: 'objc', content: objectiveCContent2 },
    { type: 'kotlin', content: kotlinContent },
    { type: 'rn', content: reactNativeContent2 },
    { type: 'cordova', content: cordovaContent }
]} />



You should make sure to call `collectDeviceIdentifiers()` after the _Purchases SDK_ is configured, and before the first purchase occurs. It's safe to call this multiple times, as only the new/updated values will be sent to RevenueCat.

:::danger Device identifiers with iOS App Tracking Transparency (iOS 14.5+)
If you are requesting the App Tracking permission through ATT to access the IDFA, you can call `.collectDeviceIdentifiers()` _again_ if the customer accepts the permission to update the `$idfa` attribute in RevenueCat.
:::

:::info Import AdSupport Framework (iOS)
The AdSupport framework is required to access the IDFA parameter on iOS. Don't forget to import this into your project.
:::

![](/images/caf9cda-Screen_Shot_2020-09-14_at_7.09.36_PM_739bc6ccef43416570bf51e527f4e0fc.png "Screen Shot 2020-09-14 at 7.09.36 PM.png")


:::danger Remove client-side purchase tracking
Make sure to remove all client-side tracking of revenue. Since RevenueCat will be sending events for all revenue actions, tracking purchases with the Branch SDK directly can lead to double counting of revenue in Branch.
:::

### (Optional) Send campaign data to RevenueCat

RevenueCat itself is not an attribution network, and can't determine which specific ad drove an install/conversion. However, if you're able to collect this information from another source, such as Branch, it's possible to attach it to a user in RevenueCat using [Subscriber Attributes](/customers/subscriber-attributes)  as well.  
The below reserved key names can be used to optionally attach campaign data to a user. This data will then be sent through to other downstream analytics integrations and accessible via APIs and webhooks.

| Key            |
| :------------- |
| `$mediaSource` |
| `$campaign`    |
| `$adGroup`     |
| `$ad`          |
| `$keyword`     |
| `$creative`    |

## 3.  Send RevenueCat events into Branch

After you've set up the _Purchases SDK_ to send attribution data from Branch to RevenueCat, you can "turn on" the integration and configure the event tokens from the RevenueCat dashboard.

1. Navigate to your project in the RevenueCat dashboard and find the _Integrations_ card in the left menu. Select **+ New** 

![](/images/c9cac9c-app.revenuecat.com_projects_85ff18c7_collaborators_1_adb02f881e911cd6bbb8e8deee68bc47.png)



2. Choose **Branch** from the Integrations menu
3. Add your test key and live key from Branch
4. Enter the event names that RevenueCat will send or choose the default event names
5. Select whether you want sales reported as gross revenue (before app store commission), or after store commission and/or estimated taxes.

![Branch configuration screen](/images/917c588-app.revenuecat.com_projects_85ff18c7_integrations_branch_1_d07138064c3aca738ff3f70198432c84.png)

:::info Branch Events
We send both START_TRIAL lifecycle events and the standard trial started events to all active Branch integrations.
:::

## 4. Testing the Branch integration

You can test the Branch integration end-to-end before going live. It's recommended that you test the integration is working properly for new users, and any existing users that may update their app to a new version.

### Add a sandbox API key in the RevenueCat dashboard

Before you test the integration, make sure you have a Branch API key set in the "Branch key test" field in RevenueCat. This is required if you want the integration to trigger for sandbox purchases.

### Make a sandbox purchase with a new user

Simulate a new user installing your app, and go through your app flow to complete a sandbox purchase.

### Check that the required device data is collected

Navigate the the [Customer View](/dashboard-and-metrics/customers-group/basic-information) for the test user that just made a purchase. Make sure that all of the required data from step 2 above is listed as attributes for the user.

![](/images/eb3d142-Screenshot_at_Sep_17_11-55-16_56862db3b4c213e796ccb367d38177f0.png "Screenshot at Sep 17 11-55-16.png")



### Check that the Branch event delivered successfully

While still on the Customer View, click into the test purchase event in the [Customer History](/dashboard-and-metrics/customers-group/customer-history) and make sure that the Branch integration event exists and was delivered successfully. 

![](/images/95d0682-app.revenuecat.com_activity_40779aaf_event_92499ad6-350b-455a-a2ec-4c28c4ca0b28_8fb8d5bf893feeb90813c31b67695560.png)


:::success You've done it!
You should start seeing events from RevenueCat appear in Branch.
:::
